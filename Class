import discord
from discord.ext import commands
import datetime

# ----- Hardcoded Schedule -----
# Format: (start_time, end_time, subject, teacher)
# Time is in 24-hour format, e.g., "07:30", "08:20"
schedule = {
    "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå": [
        ("07:30", "08:20", "Home Room", ""),
        ("08:20", "09:10", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("09:10", "10:00", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:00", "10:50", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:50", "11:40", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("11:40", "12:30", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("12:30", "13:20", "‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", ""),
        ("13:20", "14:10", "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™40247", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("14:10", "15:00", "‡∏û‡∏•‡∏®‡∏∂‡∏Å‡∏©‡∏≤", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:00", "15:50", "‡πÅ‡∏ô‡∏∞‡πÅ‡∏ô‡∏ß", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:50", "16:40", "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
    ],
    "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£": [
        ("07:30", "08:20", "Home Room", ""),
        ("08:20", "09:10", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ 30246", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("09:10", "10:00", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ 30246", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:00", "10:50", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:50", "11:40", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("11:40", "12:30", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("12:30", "13:20", "‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", ""),
        ("13:20", "14:10", "‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 30201", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("14:10", "15:00", "‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 30201", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:00", "15:50", "‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:50", "16:40", "‡∏•‡∏π‡∏Å‡πÄ‡∏™‡∏∑‡∏≠", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
    ],
    "‡∏û‡∏∏‡∏ò": [
        ("07:30", "08:20", "Home Room", ""),
        ("08:20", "09:10", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("09:10", "10:00", "‡∏Ñ‡∏ì‡∏¥‡∏ï‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:00", "10:50", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ 30246", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:50", "11:40", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ 30246", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("11:40", "12:30", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("12:30", "13:20", "‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", ""),
        ("13:20", "14:10", "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™40247", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("14:10", "15:00", "‡∏™‡∏±‡∏á‡∏Ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤ ‡∏™40247", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:00", "15:50", "‡πÅ‡∏ô‡∏∞‡πÅ‡∏ô‡∏ß", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:50", "16:40", "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
    ],
    "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ": [
        ("07:30", "08:20", "Home Room", ""),
        ("08:20", "09:10", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("09:10", "10:00", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:00", "10:50", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:50", "11:40", "‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("11:40", "12:30", "‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢ 30246", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("12:30", "13:20", "‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", ""),
        ("13:20", "14:10", "‡∏®‡∏¥‡∏•‡∏õ‡∏∞ 20201", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("14:10", "15:00", "‡∏®‡∏¥‡∏•‡∏õ‡∏∞ 20201", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:00", "15:50", "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:50", "16:40", "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
    ],
    "‡∏®‡∏∏‡∏Å‡∏£‡πå": [
        ("07:30", "08:20", "Home Room", ""),
        ("08:20", "09:10", "‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå 41105", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("09:10", "10:00", "‡∏Ñ‡∏≠‡∏°‡∏û‡∏¥‡∏ß‡πÄ‡∏ï‡∏≠‡∏£‡πå 41105", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:00", "10:50", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("10:50", "11:40", "‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏© 745", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("11:40", "12:30", "‡∏™‡∏∏‡∏Ç‡∏®‡∏∂‡∏Å‡∏©‡∏≤ 30201", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("12:30", "13:20", "‡∏û‡∏±‡∏Å‡∏Å‡∏•‡∏≤‡∏á‡∏ß‡∏±‡∏ô", ""),
        ("13:20", "14:10", "‡πÅ‡∏ô‡∏∞‡πÅ‡∏ô‡∏ß", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("14:10", "15:00", "‡πÅ‡∏ô‡∏∞‡πÅ‡∏ô‡∏ß", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:00", "15:50", "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
        ("15:50", "16:40", "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°", "‡∏Ñ‡∏£‡∏π‡∏ì‡∏±‡∏ê‡∏ß‡∏∏‡∏í‡∏¥"),
    ],
}

thai_days = {
    0: "‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå",
    1: "‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£",
    2: "‡∏û‡∏∏‡∏ò",
    3: "‡∏û‡∏§‡∏´‡∏±‡∏™‡∏ö‡∏î‡∏µ",
    4: "‡∏®‡∏∏‡∏Å‡∏£‡πå",
    5: "‡πÄ‡∏™‡∏≤‡∏£‡πå",
    6: "‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå",
}

# ----- Discord Bot Setup -----
intents = discord.Intents.default()
bot = commands.Bot(command_prefix='!', intents=intents)

def find_periods(day, now):
    periods = schedule.get(day, [])
    current = next_ = ("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "")
    found = False
    for i, (start, end, subject, teacher) in enumerate(periods):
        start_time = datetime.datetime.strptime(start, "%H:%M").time()
        end_time = datetime.datetime.strptime(end, "%H:%M").time()
        if start_time <= now < end_time:
            current = (subject, teacher)
            if i+1 < len(periods):
                next_ = (periods[i+1][2], periods[i+1][3])
            else:
                next_ = ("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "")
            found = True
            break
        elif now < start_time and not found:
            current = ("‡∏û‡∏±‡∏Å", "")
            next_ = (subject, teacher)
            found = True
            break
    if not found and periods:
        if now >= datetime.datetime.strptime(periods[-1][1], "%H:%M").time():
            current = ("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "")
            next_ = ("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏≤‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "")
    return current, next_

@bot.command()
async def class_(ctx):
    now = datetime.datetime.now(datetime.timezone(datetime.timedelta(hours=7)))  # Asia/Bangkok
    weekday = now.weekday()
    if weekday >= 5:
        await ctx.send("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô")
        return
    day_th = thai_days[weekday]
    time_now = now.strftime("%H:%M")
    current, next_ = find_periods(day_th, now.time())
    msg = (
        f"üìÖ ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ: {day_th}\n"
        f"üïí ‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏ì‡∏∞‡∏ô‡∏µ‡πâ: {time_now}\n"
        f"üè´ ‡∏Ñ‡∏≤‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô: {current[0]} {current[1]}\n"
        f"‚è≠Ô∏è ‡∏Ñ‡∏≤‡∏ö‡∏ñ‡∏±‡∏î‡πÑ‡∏õ: {next_[0]} {next_[1]}"
    )
    await ctx.send(msg)

# For Discord.py v2.x, use @bot.command(name="class") instead of @bot.command()
# To run the bot, uncomment the next line and insert your token:
# bot.run('YOUR_BOT_TOKEN')
